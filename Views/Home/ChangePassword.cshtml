@{
    Layout = null;
}

<!DOCTYPE html>
@{
    Layout = null;
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Book2Enter | Change Password</title>

    <style>
        :root {
            --primary: #00ffcc;
            --card: #111;
            --muted: #aaa;
            --error: #ff6b6b;
        }

        * { box-sizing: border-box; }

        body {
            margin: 0;
            height: 100vh;
            background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
            font-family: "Segoe UI", sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
        }

        .login-card {
            width: 380px;
            background: var(--card);
            padding: 25px;
            border-radius: 14px;
            text-align: center;
            box-shadow: 0 25px 50px rgba(0,0,0,.6);
            animation: fadeIn .8s ease;
        }

        @@keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to   { opacity: 1; transform: translateY(0); }
        }

        input {
            width: 100%;
            padding: 12px;
            margin-top: 10px;
            border-radius: 7px;
            border: 2px solid transparent;
            background: #1b1b1b;
            color: white;
            font-size: 15px;
            transition: .3s;
        }

        input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 10px rgba(0,255,204,.4);
            transform: scale(1.02);
        }

        input.error {
            border-color: var(--error);
            animation: shake .35s;
        }

        @@keyframes shake {
            0%   { transform: translateX(0); }
            25%  { transform: translateX(-5px); }
            50%  { transform: translateX(5px); }
            75%  { transform: translateX(-5px); }
            100% { transform: translateX(0); }
        }

        button.main {
            width: 100%;
            margin-top: 15px;
            padding: 12px;
            border: none;
            border-radius: 7px;
            background: var(--primary);
            color: #000;
            font-size: 16px;
            cursor: pointer;
        }

        button.main:hover {
            background: #00d6ad;
        }

        .forgot {
            font-size: 14px;
            color: var(--muted);
            display: block;
            margin-top: 8px;
            text-align: right;
            text-decoration: none;
        }

        .forgot:hover { color: var(--primary); }

        .error-text {
            margin-top: 8px;
            color: var(--error);
            display: none;
        }
    </style>
</head>

<body>

<div class="login-card">

    <h2>Change Password</h2>
    <p style="font-size:13px;opacity:.7">Enter current password then choose a new password.</p>

    <input id="userId" type="hidden" value="@User?.Identity?.Name ?? string.Empty" />
    <input id="currentPass" type="password" placeholder="Current Password" />
    <input id="newPass" type="password" placeholder="New Password" />
    <input id="confirmPass" type="password" placeholder="Confirm Password" />
    <button class="main" id="changePassBtn">Change Password</button>
    <a href="@Url.Action("Login","Home")" class="forgot">Back to Login</a>
    <div class="error-text" id="errChange"></div>

</div>

<script>
    async function postJson(url, data) {
        const res = await fetch(url, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        });
        return res.json();
    }

    changePassBtn.onclick = async () => {
        const uid = userId.value.trim();
        const cur = currentPass.value;
        const p1 = newPass.value;
        const p2 = confirmPass.value;
        if (!uid) { errChange.textContent = 'Unable to determine user. Please login.'; errChange.style.display = 'block'; return; }
        if (!cur) { errChange.textContent = 'Enter current password'; errChange.style.display = 'block'; return; }
        if (!p1 || !p2) { errChange.textContent = 'Enter and confirm new password'; errChange.style.display = 'block'; return; }
        if (p1 !== p2) { errChange.textContent = 'Passwords do not match'; errChange.style.display = 'block'; return; }
        errChange.style.display = 'none';
        try {
            const res = await postJson('/Home/ChangePassword', { UserId: uid, CurrentPassword: cur, NewPassword: p1 });
            if (!res.success) { errChange.textContent = res.message || 'Failed to change password'; errChange.style.display = 'block'; return; }
            window.location.href = res.redirectUrl || '/Home/Login';
        } catch (e) { errChange.textContent = 'Request failed'; errChange.style.display = 'block'; }
    };
</script>

</body>
</html>